# --- 稠密矩阵C (16x16) ---
dense_C = [
    [  0x1,  0x2,  0x1,  0x1,  0x1,  0x1,  0x3,  0x3,  0x1,  0x3,  0x2,  0x1, 0x1,  0x2,  0x1,  0x2],
    [  0x2,  0x3,  0x2,  0x3,  0x2,  0x1,  0x2,  0x1,  0x2,  0x3,  0x1,  0x3, 0x2,  0x2,  0x3,  0x2],
    [  0x3,  0x1,  0x3,  0x3,  0x3,  0x3,  0x2,  0x1,  0x3,  0x2,  0x1,  0x2, 0x3,  0x1,  0x3,  0x1],
    [  0x4,  0x1,  0x2,  0x1,  0x4,  0x3,  0x1,  0x3,  0x4,  0x2,  0x3,  0x2, 0x4,  0x2,  0x1,  0x1],
    [  0x5,  0x3,  0x2,  0x1,  0x5,  0x2,  0x1,  0x2,  0x5,  0x1,  0x3,  0x1, 0x5,  0x3,  0x2,  0x3],
    [  0x6,  0x3,  0x1,  0x3,  0x6,  0x2,  0x3,  0x2,  0x6,  0x2,  0x1,  0x1, 0x6,  0x1,  0x3,  0x3],
    [  0x7,  0x2,  0x1,  0x2,  0x7,  0x1,  0x3,  0x1,  0x7,  0x3,  0x2,  0x3, 0x7,  0x1,  0x2,  0x1],
    [  0x8,  0x2,  0x3,  0x2,  0x8,  0x2,  0x1,  0x1,  0x8,  0x1,  0x3,  0x3, 0x8,  0x3,  0x2,  0x1],
    [  0x9,  0x1,  0x3,  0x1,  0x9,  0x3,  0x2,  0x3,  0x9,  0x1,  0x2,  0x1, 0x9,  0x3,  0x1,  0x3],
    [ 0x10,  0x2,  0x1,  0x1, 0x10,  0x1,  0x3,  0x3, 0x10,  0x3,  0x2,  0x1,0x10,  0x2,  0x1,  0x2],
    [ 0x11,  0x3,  0x2,  0x3, 0x11,  0x1,  0x2,  0x1, 0x11,  0x3,  0x1,  0x3,0x11,  0x2,  0x3,  0x2],
    [ 0x12,  0x1,  0x3,  0x3, 0x12,  0x3,  0x2,  0x1, 0x12,  0x2,  0x1,  0x2,0x12,  0x1,  0x3,  0x1],
    [ 0x13,  0x1,  0x2,  0x1, 0x13,  0x3,  0x1,  0x3, 0x13,  0x2,  0x3,  0x2,0x13,  0x2,  0x1,  0x1],
    [ 0x14,  0x3,  0x2,  0x1, 0x14,  0x2,  0x1,  0x2, 0x14,  0x1,  0x3,  0x1,0x14,  0x3,  0x2,  0x3],
    [ 0x15,  0x3,  0x1,  0x3, 0x15,  0x2,  0x3,  0x2, 0x15,  0x2,  0x1,  0x1,0x15,  0x1,  0x3,  0x3],
    [ 0x16,  0x2,  0x1,  0x2, 0x16,  0x1,  0x3,  0x1, 0x16,  0x3,  0x2,  0x3,0x16,  0x1,  0x2,  0x1]
]

# --- 稠密矩阵D (16x16) ---
dense_D = [
    [  0x0,  0x1,  0x0,  0x0,  0x0,  0x0,  0x2,  0x2,  0x0,  0x2,  0x1,  0x0, 0x0,  0x1,  0x0,  0x1],
    [  0x1,  0x2,  0x1,  0x2,  0x1,  0x0,  0x1,  0x0,  0x1,  0x2,  0x0,  0x2, 0x1,  0x1,  0x2,  0x1],
    [  0x2,  0x0,  0x2,  0x2,  0x2,  0x2,  0x1,  0x0,  0x2,  0x1,  0x0,  0x1, 0x2,  0x0,  0x2,  0x0],
    [  0x3,  0x0,  0x1,  0x0,  0x3,  0x2,  0x0,  0x2,  0x3,  0x1,  0x2,  0x1, 0x3,  0x1,  0x0,  0x0],
    [  0x4,  0x2,  0x1,  0x0,  0x4,  0x1,  0x0,  0x1,  0x4,  0x0,  0x2,  0x0, 0x4,  0x2,  0x1,  0x2],
    [  0x5,  0x2,  0x0,  0x2,  0x5,  0x1,  0x2,  0x1,  0x5,  0x1,  0x0,  0x0, 0x5,  0x0,  0x2,  0x2],
    [  0x6,  0x1,  0x0,  0x1,  0x6,  0x0,  0x2,  0x0,  0x6,  0x2,  0x1,  0x2, 0x6,  0x0,  0x1,  0x0],
    [  0x7,  0x1,  0x2,  0x1,  0x7,  0x1,  0x0,  0x0,  0x7,  0x0,  0x2,  0x2, 0x7,  0x2,  0x1,  0x0],
    [  0x8,  0x0,  0x2,  0x0,  0x8,  0x2,  0x1,  0x2,  0x8,  0x0,  0x1,  0x0, 0x8,  0x2,  0x0,  0x2],
    [  0xF,  0x1,  0x0,  0x0,  0xF,  0x0,  0x2,  0x2,  0xF,  0x2,  0x1,  0x0, 0xF,  0x1,  0x0,  0x1],
    [ 0x10,  0x2,  0x1,  0x2, 0x10,  0x0,  0x1,  0x0, 0x10,  0x2,  0x0,  0x2,0x10,  0x1,  0x2,  0x1],
    [ 0x11,  0x0,  0x2,  0x2, 0x11,  0x2,  0x1,  0x0, 0x11,  0x1,  0x0,  0x1,0x11,  0x0,  0x2,  0x0],
    [ 0x12,  0x0,  0x1,  0x0, 0x12,  0x2,  0x0,  0x2, 0x12,  0x1,  0x2,  0x1,0x12,  0x1,  0x0,  0x0],
    [ 0x13,  0x2,  0x1,  0x0, 0x13,  0x1,  0x0,  0x1, 0x13,  0x0,  0x2,  0x0,0x13,  0x2,  0x1,  0x2],
    [ 0x14,  0x2,  0x0,  0x2, 0x14,  0x1,  0x2,  0x1, 0x14,  0x1,  0x0,  0x0,0x14,  0x0,  0x2,  0x2],
    [ 0x15,  0x1,  0x0,  0x1, 0x15,  0x0,  0x2,  0x0, 0x15,  0x2,  0x1,  0x2,0x15,  0x0,  0x1,  0x0]
]

# --- 稀疏矩阵 1 (CSR) ---
row_ptr1 = [0, 3, 7, 11, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 19]
data1    = [1, 2, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 3, 2, 1]
col_idx1 = [0, 9,12, 3, 7,11,15, 2, 3,10,15, 2, 4,10,14, 2, 6,10,14]

# --- 稀疏矩阵 2 (CSR) ---
row_ptr2 = [0, 4, 9, 12, 12, 12, 15, 17, 17, 17, 17, 17, 17, 17, 17, 17, 19]
data2    = [1, 2, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 3, 2, 1]
col_idx2 = [0, 8,12, 9, 7,11,15, 8, 3,10,7, 2, 7,10,15, 2, 6,10,14]

n = 16

# 重建稀疏矩阵 A
A = [[0] * n for _ in range(n)]
for i in range(n):
    for p in range(row_ptr1[i], row_ptr1[i+1]):
        A[i][col_idx1[p]] = data1[p]

# 重建稀疏矩阵 B
B = [[0] * n for _ in range(n)]
for i in range(n):
    for p in range(row_ptr2[i], row_ptr2[i+1]):
        B[i][col_idx2[p]] = data2[p]

# 矩阵乘法：X @ Y
def mat_mul(X, Y, n):
    result = [[0] * n for _ in range(n)]
    for i in range(n):
        for k in range(n):
            if X[i][k] != 0:  # 稀疏优化
                for j in range(n):
                    result[i][j] += X[i][k] * Y[k][j]
    return result

# 计算 A*C 和 B*D
AC = mat_mul(A, dense_C, n)
BD = mat_mul(B, dense_D, n)

# 结果 R = A*C + B*D
R = [[AC[i][j] + BD[i][j] for j in range(n)] for i in range(n)]

# --- 打印函数（十六进制显示）---
def print_block_hex(title, mat):
    print(f"\n{title}")
    print("+" + "-" * 79 + "+")
    for i in range(len(mat)):
        row_str = " ".join(f"{x:02X}" if x != 0 else " ." for x in mat[i])
        print(f"| {i:02d} | " + row_str + " |")
    print("+" + "-" * 79 + "+")

# --- 打印所有矩阵（全部用十六进制格式显示）---
print_block_hex("稠密矩阵 C (16×16)", dense_C)
print_block_hex("稠密矩阵 D (16×16)", dense_D)
print_block_hex("稀疏矩阵 A (16×16)", A)
print_block_hex("稀疏矩阵 B (16×16)", B)
print_block_hex("中间结果矩阵 AC = A*C", AC)
print_block_hex("中间结果矩阵 BD = B*D", BD)
print_block_hex("最终结果矩阵 R = A*C + B*D", R)